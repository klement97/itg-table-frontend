<section style="padding: 15px">
    <mat-card>
        <mat-card-content>
            <form (ngSubmit)="filterOrders()" [formGroup]="filterForm" fxLayout="column" fxShow [fxShow.lt-md]="true">

                <div fxLayout="row" fxLayout.lt-md="column" fxLayoutGap="1rem">

                    <div fxLayout="row" fxLayoutGap="10px" fxFlex="50%">
                        <!-- ID -->
                        <mat-form-field appearance="outline" fxFlex="50%">
                            <mat-label>ID</mat-label>
                            <input type="number" formControlName="id" placeholder="ID" matInput>
                        </mat-form-field>

                        <!-- Customer -->
                        <mat-form-field appearance="outline" fxFlex="50%">
                            <mat-label>Klienti</mat-label>
                            <input formControlName="customer" matInput placeholder="Klienti" type="text">
                        </mat-form-field>
                    </div>

                    <div fxLayout="row" fxLayoutGap="10px" fxFlex="50%">
                        <!-- Date Created After -->
                        <mat-form-field appearance="outline" fxFlex="50%">
                            <mat-label>Na kjo datë</mat-label>
                            <input type="text" formControlName="date_created_after" matInput
                                   [matDatepicker]="date_after">
                            <mat-datepicker-toggle matSuffix [for]="date_after"></mat-datepicker-toggle>
                            <mat-datepicker #date_after></mat-datepicker>
                        </mat-form-field>

                        <!-- Date Created Before -->
                        <mat-form-field appearance="outline" fxFlex="50%">
                            <mat-label>Deri në këtë datë</mat-label>
                            <input type="text" formControlName="date_created_before" matInput
                                   [matDatepicker]="date_before">
                            <mat-datepicker-toggle matSuffix [for]="date_before"></mat-datepicker-toggle>
                            <mat-datepicker #date_before></mat-datepicker>
                        </mat-form-field>
                    </div>
                </div>

                <div fxLayout="row" fxLayoutGap="10px">
                    <button color="primary" mat-stroked-button type="submit" fxFlex="50%">
                        <mat-icon>search</mat-icon>&nbsp;Kërko
                    </button>

                    <button mat-stroked-button color="primary" type="button" fxFlex="50%"
                            (click)="initiateFilterForm()">
                        <mat-icon>clear</mat-icon>&nbsp;Pastro
                    </button>
                </div>
            </form>
        </mat-card-content>
    </mat-card>
    <mat-card>
        <!-- Content-->
        <mat-card-content style="overflow-x: auto">
            <div style="height: 5px">
                <mat-progress-bar *ngIf="loading$ | async" mode="indeterminate" style="height: 5px"></mat-progress-bar>
            </div>
            <table (matSortChange)="sortOrders($event)" [dataSource]="orders$ | async"
                   mat-table matSort
                   matSortDisableClear matSortActive="date_created" matSortDirection="desc"
                   class="mat-elevation-z4 data-table">

                <!-- ID -->
                <ng-container matColumnDef="id">
                    <th *matHeaderCellDef mat-header-cell mat-sort-header>ID</th>
                    <td *matCellDef="let order" mat-cell>
                        <button mat-stroked-button (click)="showDetails(order)">{{order.id}}</button>
                    </td>
                </ng-container>

                <!-- Customer -->
                <ng-container matColumnDef="customer">
                    <th *matHeaderCellDef mat-header-cell mat-sort-header> Klienti</th>
                    <td *matCellDef="let order" mat-cell> {{order.customer}} </td>
                </ng-container>

                <!-- Date Created -->
                <ng-container matColumnDef="date_created">
                    <th *matHeaderCellDef mat-header-cell mat-sort-header> Data</th>
                    <td *matCellDef="let order" mat-cell> {{order.date_created | date: 'dd/MM/yyyy HH:mm' : ''}} </td>
                </ng-container>

                <!-- Total Price -->
                <ng-container matColumnDef="total_price">
                    <th *matHeaderCellDef mat-header-cell> Çmimi total</th>
                    <td *matCellDef="let order" mat-cell> ${{order.total_price}}</td>
                </ng-container>

                <!-- Total Table Count -->
                <ng-container matColumnDef="total_table_count">
                    <th *matHeaderCellDef mat-header-cell> Numri total i tabakave</th>
                    <td *matCellDef="let order" mat-cell> {{order.total_table_count}} copë</td>
                </ng-container>

                <!-- Actions -->
                <ng-container matColumnDef="actions">
                    <th *matHeaderCellDef mat-header-cell>Veprime</th>
                    <td *matCellDef="let order" mat-cell>
                <span class="flex-row">
                    <a (click)="updateOrder(order.id)" mat-icon-button><mat-icon
                            style="opacity: 0.7">build</mat-icon></a>
                    <button (click)="deleteOrder(order.id)" mat-icon-button><mat-icon
                            style="opacity: 0.7">delete_sweep</mat-icon></button>
                  <button (click)="openEmailSendDialog(order)" mat-icon-button><mat-icon
                          style="opacity: 0.7;">email</mat-icon></button>
                </span>
                    </td>
                </ng-container>

                <!-- Header and Row Declarations -->
                <tr *matHeaderRowDef="displayedColumns" mat-header-row></tr>
                <tr *matRowDef="let row; columns: displayedColumns" mat-row></tr>
            </table>
        </mat-card-content>

        <!-- Footer -->
        <mat-card-footer>
            <mat-paginator #paginator (page)="getOrders()" [length]="count$ | async" pageSize="10"
                           showFirstLastButtons></mat-paginator>
        </mat-card-footer>
    </mat-card>
</section>
